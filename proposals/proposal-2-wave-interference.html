<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposal 2: Wave Interference Simulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0d1b2a 0%, #1b263b 100%);
            color: white;
            overflow: hidden;
        }
        #container { width: 100vw; height: 100vh; position: relative; }
        #canvas { display: block; }
        .panel {
            position: absolute;
            background: rgba(15, 25, 45, 0.95);
            border: 1px solid rgba(0, 200, 255, 0.3);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        .header {
            top: 20px; left: 20px; right: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        h1 { font-size: 1.5rem; background: linear-gradient(90deg, #00d4ff, #7b2cbf); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .badge { background: linear-gradient(135deg, #7b2cbf, #e040fb); padding: 6px 14px; border-radius: 20px; font-size: 0.75rem; }
        .controls { bottom: 20px; left: 20px; width: 320px; }
        .control-group { margin-bottom: 18px; }
        .control-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        label { color: #00d4ff; font-size: 0.85rem; font-weight: 500; }
        .value { color: #e040fb; font-weight: bold; }
        input[type="range"] {
            width: 100%; height: 8px; border-radius: 4px;
            background: linear-gradient(90deg, rgba(0,212,255,0.2), rgba(123,44,191,0.2));
            -webkit-appearance: none; cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px; height: 20px; border-radius: 50%;
            background: linear-gradient(135deg, #00d4ff, #7b2cbf);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
        }
        .presets { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 15px; }
        .preset {
            padding: 8px 14px; border: 1px solid rgba(0, 212, 255, 0.4);
            border-radius: 20px; background: transparent; color: #00d4ff;
            cursor: pointer; font-size: 0.8rem; transition: all 0.3s;
        }
        .preset:hover { background: rgba(0, 212, 255, 0.2); transform: scale(1.05); }
        .preset.active { background: linear-gradient(135deg, #00d4ff, #7b2cbf); color: white; border-color: transparent; }
        .info-panel { bottom: 20px; right: 20px; width: 280px; }
        .wave-info { margin-bottom: 15px; padding: 12px; background: rgba(0, 212, 255, 0.1); border-radius: 8px; }
        .wave-info h3 { color: #00d4ff; font-size: 0.9rem; margin-bottom: 8px; }
        .formula { font-family: 'Times New Roman', serif; font-size: 1.1rem; color: #e0e0e0; text-align: center; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px; }
        .legend { margin-top: 15px; }
        .legend-item { display: flex; align-items: center; gap: 10px; margin: 8px 0; font-size: 0.85rem; }
        .legend-bar { width: 30px; height: 8px; border-radius: 4px; }
        .mode-toggle { display: flex; gap: 10px; margin-top: 15px; }
        .mode-btn {
            flex: 1; padding: 10px; border: none; border-radius: 8px;
            background: rgba(0, 212, 255, 0.1); color: #00d4ff;
            cursor: pointer; transition: all 0.3s; font-weight: 500;
        }
        .mode-btn.active { background: linear-gradient(135deg, #00d4ff, #7b2cbf); color: white; }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="canvas"></canvas>

        <div class="panel header">
            <div>
                <h1>Wave Interference Simulator</h1>
                <p style="color: #90caf9; font-size: 0.85rem;">Lesson: Waves & Oscillations</p>
            </div>
            <span class="badge">PROPOSAL 2</span>
        </div>

        <div class="panel controls">
            <div class="control-group">
                <div class="control-header">
                    <label>Wave 1 Frequency</label>
                    <span class="value" id="freq1Val">2.0 Hz</span>
                </div>
                <input type="range" id="freq1" min="0.5" max="5" step="0.1" value="2">
            </div>
            <div class="control-group">
                <div class="control-header">
                    <label>Wave 2 Frequency</label>
                    <span class="value" id="freq2Val">2.5 Hz</span>
                </div>
                <input type="range" id="freq2" min="0.5" max="5" step="0.1" value="2.5">
            </div>
            <div class="control-group">
                <div class="control-header">
                    <label>Amplitude</label>
                    <span class="value" id="ampVal">1.0</span>
                </div>
                <input type="range" id="amplitude" min="0.2" max="2" step="0.1" value="1">
            </div>
            <div class="control-group">
                <div class="control-header">
                    <label>Phase Difference</label>
                    <span class="value" id="phaseVal">0°</span>
                </div>
                <input type="range" id="phase" min="0" max="360" step="5" value="0">
            </div>

            <div class="presets">
                <button class="preset active" data-preset="beat">Beat Pattern</button>
                <button class="preset" data-preset="constructive">Constructive</button>
                <button class="preset" data-preset="destructive">Destructive</button>
                <button class="preset" data-preset="standing">Standing Wave</button>
            </div>

            <div class="mode-toggle">
                <button class="mode-btn active" id="mode3d">3D Surface</button>
                <button class="mode-btn" id="mode2d">2D Waves</button>
            </div>
        </div>

        <div class="panel info-panel">
            <div class="wave-info">
                <h3>Superposition Principle</h3>
                <div class="formula">y = y₁ + y₂ = A sin(ω₁t) + A sin(ω₂t)</div>
            </div>
            <div class="wave-info">
                <h3>Beat Frequency</h3>
                <div class="formula">f<sub>beat</sub> = |f₁ - f₂| = <span id="beatFreq">0.5</span> Hz</div>
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-bar" style="background: linear-gradient(90deg, #00d4ff, #0088ff);"></div>
                    <span>Wave 1</span>
                </div>
                <div class="legend-item">
                    <div class="legend-bar" style="background: linear-gradient(90deg, #e040fb, #7b2cbf);"></div>
                    <span>Wave 2</span>
                </div>
                <div class="legend-item">
                    <div class="legend-bar" style="background: linear-gradient(90deg, #00ff88, #00cc6a);"></div>
                    <span>Resultant</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        let scene, camera, renderer;
        let waveMesh, wave1Line, wave2Line, resultLine;
        let freq1 = 2, freq2 = 2.5, amplitude = 1, phase = 0;
        let time = 0;
        let mode = '3d';

        const segments = 100;
        const width = 20;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 15, 20);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // Lighting
            const ambient = new THREE.AmbientLight(0x404060, 0.5);
            scene.add(ambient);
            const directional = new THREE.DirectionalLight(0xffffff, 0.8);
            directional.position.set(5, 10, 5);
            scene.add(directional);

            create3DWave();
            setupControls();
            animate();
        }

        function create3DWave() {
            // Remove existing
            if (waveMesh) scene.remove(waveMesh);
            if (wave1Line) scene.remove(wave1Line);
            if (wave2Line) scene.remove(wave2Line);
            if (resultLine) scene.remove(resultLine);

            if (mode === '3d') {
                // 3D surface
                const geometry = new THREE.PlaneGeometry(width, width, segments, segments);
                const material = new THREE.MeshPhongMaterial({
                    color: 0x00d4ff,
                    side: THREE.DoubleSide,
                    wireframe: false,
                    transparent: true,
                    opacity: 0.8,
                    shininess: 100
                });
                waveMesh = new THREE.Mesh(geometry, material);
                waveMesh.rotation.x = -Math.PI / 2;
                scene.add(waveMesh);

                // Add wireframe overlay
                const wireGeo = new THREE.PlaneGeometry(width, width, segments, segments);
                const wireMat = new THREE.MeshBasicMaterial({ color: 0x00ff88, wireframe: true, transparent: true, opacity: 0.3 });
                const wireMesh = new THREE.Mesh(wireGeo, wireMat);
                wireMesh.rotation.x = -Math.PI / 2;
                wireMesh.position.y = 0.01;
                waveMesh.add(wireMesh);
            } else {
                // 2D lines
                const points1 = [], points2 = [], pointsR = [];
                for (let i = 0; i <= segments; i++) {
                    points1.push(new THREE.Vector3(i * width / segments - width/2, 0, 3));
                    points2.push(new THREE.Vector3(i * width / segments - width/2, 0, 0));
                    pointsR.push(new THREE.Vector3(i * width / segments - width/2, 0, -3));
                }

                wave1Line = new THREE.Line(
                    new THREE.BufferGeometry().setFromPoints(points1),
                    new THREE.LineBasicMaterial({ color: 0x00d4ff, linewidth: 3 })
                );
                wave2Line = new THREE.Line(
                    new THREE.BufferGeometry().setFromPoints(points2),
                    new THREE.LineBasicMaterial({ color: 0xe040fb, linewidth: 3 })
                );
                resultLine = new THREE.Line(
                    new THREE.BufferGeometry().setFromPoints(pointsR),
                    new THREE.LineBasicMaterial({ color: 0x00ff88, linewidth: 4 })
                );

                scene.add(wave1Line);
                scene.add(wave2Line);
                scene.add(resultLine);

                camera.position.set(0, 0, 25);
                camera.lookAt(0, 0, 0);
            }
        }

        function updateWave() {
            if (mode === '3d' && waveMesh) {
                const positions = waveMesh.geometry.attributes.position.array;
                for (let i = 0; i <= segments; i++) {
                    for (let j = 0; j <= segments; j++) {
                        const idx = (i * (segments + 1) + j) * 3;
                        const x = (j / segments - 0.5) * width;
                        const z = (i / segments - 0.5) * width;
                        const r = Math.sqrt(x*x + z*z);

                        const y1 = amplitude * Math.sin(freq1 * r - time * freq1 * 2);
                        const y2 = amplitude * Math.sin(freq2 * r - time * freq2 * 2 + phase * Math.PI / 180);

                        positions[idx + 2] = y1 + y2;
                    }
                }
                waveMesh.geometry.attributes.position.needsUpdate = true;
                waveMesh.geometry.computeVertexNormals();

                // Update color based on height
                const colors = [];
                for (let i = 0; i < positions.length; i += 3) {
                    const h = positions[i + 2];
                    const t = (h + 2) / 4;
                    colors.push(t * 0.5, 0.8, 1 - t * 0.5);
                }
                waveMesh.geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
                waveMesh.material.vertexColors = true;
            } else if (mode === '2d') {
                const pos1 = wave1Line.geometry.attributes.position.array;
                const pos2 = wave2Line.geometry.attributes.position.array;
                const posR = resultLine.geometry.attributes.position.array;

                for (let i = 0; i <= segments; i++) {
                    const x = (i / segments - 0.5) * width;
                    const y1 = amplitude * Math.sin(freq1 * x * 0.5 - time * freq1 * 2);
                    const y2 = amplitude * Math.sin(freq2 * x * 0.5 - time * freq2 * 2 + phase * Math.PI / 180);

                    pos1[i * 3 + 1] = y1 * 2;
                    pos2[i * 3 + 1] = y2 * 2;
                    posR[i * 3 + 1] = (y1 + y2) * 2;
                }

                wave1Line.geometry.attributes.position.needsUpdate = true;
                wave2Line.geometry.attributes.position.needsUpdate = true;
                resultLine.geometry.attributes.position.needsUpdate = true;
            }
        }

        function setupControls() {
            document.getElementById('freq1').addEventListener('input', (e) => {
                freq1 = parseFloat(e.target.value);
                document.getElementById('freq1Val').textContent = freq1.toFixed(1) + ' Hz';
                document.getElementById('beatFreq').textContent = Math.abs(freq1 - freq2).toFixed(1);
            });

            document.getElementById('freq2').addEventListener('input', (e) => {
                freq2 = parseFloat(e.target.value);
                document.getElementById('freq2Val').textContent = freq2.toFixed(1) + ' Hz';
                document.getElementById('beatFreq').textContent = Math.abs(freq1 - freq2).toFixed(1);
            });

            document.getElementById('amplitude').addEventListener('input', (e) => {
                amplitude = parseFloat(e.target.value);
                document.getElementById('ampVal').textContent = amplitude.toFixed(1);
            });

            document.getElementById('phase').addEventListener('input', (e) => {
                phase = parseFloat(e.target.value);
                document.getElementById('phaseVal').textContent = phase + '°';
            });

            // Presets
            document.querySelectorAll('.preset').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.preset').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const preset = btn.dataset.preset;
                    if (preset === 'beat') {
                        document.getElementById('freq1').value = 2; freq1 = 2;
                        document.getElementById('freq2').value = 2.5; freq2 = 2.5;
                        document.getElementById('phase').value = 0; phase = 0;
                    } else if (preset === 'constructive') {
                        document.getElementById('freq1').value = 2; freq1 = 2;
                        document.getElementById('freq2').value = 2; freq2 = 2;
                        document.getElementById('phase').value = 0; phase = 0;
                    } else if (preset === 'destructive') {
                        document.getElementById('freq1').value = 2; freq1 = 2;
                        document.getElementById('freq2').value = 2; freq2 = 2;
                        document.getElementById('phase').value = 180; phase = 180;
                    } else if (preset === 'standing') {
                        document.getElementById('freq1').value = 3; freq1 = 3;
                        document.getElementById('freq2').value = 3; freq2 = 3;
                        document.getElementById('phase').value = 90; phase = 90;
                    }
                    updateDisplayValues();
                });
            });

            // Mode toggle
            document.getElementById('mode3d').addEventListener('click', () => {
                mode = '3d';
                document.getElementById('mode3d').classList.add('active');
                document.getElementById('mode2d').classList.remove('active');
                camera.position.set(0, 15, 20);
                camera.lookAt(0, 0, 0);
                create3DWave();
            });

            document.getElementById('mode2d').addEventListener('click', () => {
                mode = '2d';
                document.getElementById('mode2d').classList.add('active');
                document.getElementById('mode3d').classList.remove('active');
                create3DWave();
            });

            // Mouse controls
            let isDragging = false, prevX, prevY;
            renderer.domElement.addEventListener('mousedown', (e) => { isDragging = true; prevX = e.clientX; prevY = e.clientY; });
            renderer.domElement.addEventListener('mouseup', () => isDragging = false);
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (isDragging && mode === '3d') {
                    camera.position.x += (e.clientX - prevX) * 0.05;
                    camera.position.y += (e.clientY - prevY) * 0.05;
                    camera.lookAt(0, 0, 0);
                    prevX = e.clientX;
                    prevY = e.clientY;
                }
            });
            renderer.domElement.addEventListener('wheel', (e) => {
                camera.position.z += e.deltaY * 0.02;
                camera.position.z = Math.max(10, Math.min(50, camera.position.z));
            });
        }

        function updateDisplayValues() {
            document.getElementById('freq1Val').textContent = freq1.toFixed(1) + ' Hz';
            document.getElementById('freq2Val').textContent = freq2.toFixed(1) + ' Hz';
            document.getElementById('phaseVal').textContent = phase + '°';
            document.getElementById('beatFreq').textContent = Math.abs(freq1 - freq2).toFixed(1);
        }

        function animate() {
            requestAnimationFrame(animate);
            time += 0.016;
            updateWave();
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        init();
    </script>
</body>
</html>
